# Сервис бронирования отелей (Booking Service)

Простой HTTP JSON API для управления номерами отелей и их бронированиями. Проект выполнен в рамках тестового задания.

## Основные технологии

*   **Язык:** Python 3.13
*   **Фреймворк:** Django 5.2
*   **База данных:** PostgreSQL
*   **Тестирование:** Pytest, Coverage.py
*   **Управление зависимостями:** Poetry

## Особенности реализации

*   **API:** Реализован REST-подобный интерфейс для всех CRUD-операций с номерами и бронированиями.
*   **Валидация:** Используется встроенный механизм `Django Forms` для надежной валидации всех входящих данных.
*   **Дополнительное задание:** Реализована проверка на пересечение дат при создании бронирования, что предотвращает двойное бронирование номеров.
*   **Тестирование:** Проект покрыт юнит- и интеграционными тестами. Уровень покрытия кода составляет **89%**.
*   **База данных:** Проект настроен для работы с PostgreSQL, как и требовалось в ТЗ. Схема базы данных приложена в файле `database_schema.sql`.

---

## Инструкция по запуску

### 1. Предварительные требования

*   Python 3.13+
*   Poetry
*   PostgreSQL
*   Git

### 2. Установка и настройка

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/so0siickk/booking-service.git
    cd booking-service
    ```

2.  **Установите зависимости:**
    *Poetry создаст виртуальное окружение и установит все необходимые пакеты из `pyproject.toml`.*
    ```bash
    poetry install
    ```

3.  **Активируйте виртуальное окружение (рекомендуется):**
    *Эта команда "входит" в изолированное окружение проекта. Все последующие команды можно будет выполнять напрямую.*
    ```bash
    poetry shell
    ```
    *После этого в начале строки вашего терминала появится название окружения, например, `(booking-service-py3.13)`.*

4.  **Настройте базу данных:**
    - Запустите ваш сервер PostgreSQL.
    - Создайте новую базу данных (например, `booking_service_db`).

5.  **Настройте переменные окружения:**
    - Создайте файл `.env` в корневой папке проекта.
    - Заполните его по примеру:
      ```env
      DB_NAME=booking_service_db
      DB_USER=ваш_пользователь_pg
      DB_PASSWORD=ваш_пароль_pg
      DB_HOST=localhost
      DB_PORT=5432
      ```

6.  **Примените миграции:**
    *(Если вы активировали окружение через `poetry shell`, используйте первую команду. Если нет, используйте вторую).*
    ```bash
    # Способ 1 (внутри poetry shell)
    python manage.py migrate

    # Способ 2 (без активации shell)
    poetry run python manage.py migrate
    ```

7.  **Запустите сервер разработки:**
    ```bash
    # Способ 1 (внутри poetry shell)
    python manage.py runserver

    # Способ 2 (без активации shell)
    poetry run python manage.py runserver
    ```
    API будет доступно по адресу `http://127.0.0.1:8000/api/`.
### 3. Запуск тестов

Для запуска всех тестов и просмотра отчета о покрытии выполните команду:

```bash
coverage run -m pytest
```
Для просмотра отчета о покрытии в консоли:
```bash
coverage report
```
---

## Документация API

Здесь вы описываете каждый хендлер, как мы уже обсуждали.

### Ресурс: Номера (`Rooms`)

#### **Получить список номеров**
- **URL:** `/api/rooms/`
- **Метод:** `GET`
- **Параметры:** `hotel_id` (integer, обязательный).
- **Пример:** `curl "http://localhost:8000/api/rooms/?hotel_id=1"`
- **Ответ:** `200 OK` со списком номеров.

#### **Создать номер**
- **URL:** `/api/rooms/`
- **Метод:** `POST`
- **Тело запроса (JSON):**
  ```json
  {
    "title": "Новый номер",
    "price": "9500.00",
    "sleep_places": 2,
    "floor": 10,
    "category": "UP",
    "hotel": 1
  }
  ```
- **Ответ:** `201 Created` с `{"room_id": N}`.

#### **Получить данные о номере**
- **URL:** `/api/rooms/<id>/`
- **Метод:** `GET`
- **Пример:** `curl "http://localhost:8000/api/rooms/1/"`
- **Ответ:** `200 OK` с JSON-объектом номера.
  ```json
  {
    "id": 1,
    "title": "Делюкс с кроватью king-size",
    "price": "8075.00",
    "sleep_places": 1,
    "floor": 5,
    "category": "Делюкс",
    "hotel_id": 1
  }
  ```
  
#### **Удалить номер**
- **URL:** `/api/rooms/<id>/`
- **Метод:** `DELETE`
- **Пример:** `curl -X DELETE "http://localhost:8000/api/rooms/1/"`
- **Ответ:** `204 No Content` (пустое тело ответа).

#### **Создать бронирование**
- **URL:** `/api/bookings/`
- **Метод:** `POST`
- **Тело запроса (JSON):**
  ```json
  {
    "start_date": "2025-12-01",
    "end_date": "2025-12-05",
    "guest_name": "Тестовый гость",
    "room": 10
  }
  ```
- **Ответ:** `201` с `{"booking_id": booking_id}`.

#### **Получить список бронирований**
- **URL:** `/api/bookings/`
- **Метод:** `GET`
- **Параметры:** `room_id` (integer, обязательный).
- **Пример:** `curl "http://localhost:8000/api/bookings/?room_id=1"`
- **Ответ:** `200 OK` со списком бронирований.
  ```json
  [
    {
      "id": 1,
      "start_date": "2025-11-10",
      "end_date": "2025-11-15"
    }
  ]
  ```
  
#### **Удалить бронирование**
- **URL:** `/api/bookings/<id>/`
- **Метод:** `DELETE`
- **Пример:** `curl -X DELETE "http://localhost:8000/api/bookings/1/"`
- **Ответ:** `204 No Content`.

## Принятые решения (по ТЗ)


*   **Использование слагов вместо ID на сайте:** Для веб-интерфейса были использованы человеко-понятные URL (слаги) для лучшего SEO и читаемости, в то время как API, согласно ТЗ, оперирует ID для простоты программного взаимодействия.
*   **Разделение `views` и `api_views`:** Код для HTML-интерфейса и для JSON API был намеренно разделен для соблюдения принципа разделения ответственности и упрощения дальнейшей поддержки.
*   **Использование Django Forms для валидации в API:** Вместо ручной проверки данных был использован мощный механизм `ModelForm`, который обеспечивает надежную и расширяемую валидацию "из коробки".

---

## Запуск через Docker (Рекомендуемый способ)

Проект полностью контейнеризирован с помощью Docker и Docker Compose, что позволяет запустить его одной командой без необходимости устанавливать Python, PostgreSQL или зависимости на вашу хост-систему.

### 1. Предварительные требования

*   [Docker](https://www.docker.com/products/docker-desktop/)
*   [Docker Compose](https://docs.docker.com/compose/install/) (обычно поставляется вместе с Docker Desktop)

### 2. Установка и запуск

1.  **Клонируйте репозиторий и перейдите в него.**

2.  **Настройте переменные окружения для Docker:**
    - Создайте файл `.env` в корневой папке проекта (можно скопировать существующий).
    - **ВАЖНО:** В файле `.env` измените хост базы данных на имя сервиса из `docker-compose.yml`:
      ```env
      DB_HOST=db 
      ```
      *Остальные переменные (`DB_NAME`, `DB_USER`, `DB_PASSWORD`) должны совпадать с теми, что используются в `docker-compose.yml`.*

3.  **Соберите и запустите контейнеры:**
    - Выполните в терминале из корневой папки проекта:
      ```bash
      docker-compose up --build
      ```
    - Флаг `--build` необходим при первом запуске, чтобы собрать образ для Django-приложения.
    - При последующих запусках можно использовать просто `docker-compose up`.

4.  **Готово!**
    - Сервис будет доступен по адресу `http://127.0.0.1:8000/`.
    - База данных PostgreSQL будет работать в своем контейнере, а ее данные будут сохраняться в папке `postgres_data` на вашем компьютере.

### 3. Выполнение Django-команд

Для выполнения команд `manage.py` (например, `migrate` или `createsuperuser`) используйте `docker-compose exec`:

```bash
# Применить миграции (делается автоматически при запуске, но может понадобиться)
docker-compose exec web poetry run python manage.py migrate

# Создать суперпользователя
docker-compose exec web poetry run python manage.py createsuperuser
```

### 4. Остановка сервиса

Чтобы остановить все контейнеры, нажмите `Ctrl+C` в терминале, где запущен `docker-compose up`, а затем выполните:```bash
docker-compose down
```